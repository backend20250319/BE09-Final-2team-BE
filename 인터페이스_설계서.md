# Momnect 서비스 인터페이스 설계서

## 개요

Momnect는 마이크로서비스 아키텍처로 구성된 중고거래 플랫폼입니다. 각 서비스는 독립적으로 운영되며, API Gateway를 통해 통합 관리됩니다.

## 서비스 구성

- **Gateway Service**: API Gateway (포트: 8000)
- **Discovery Service**: Eureka Server (포트: 8761)
- **User Service**: 사용자 관리 (포트: 동적 할당)
- **Product Service**: 상품 관리 (포트: 동적 할당)
- **Post Service**: 커뮤니티 게시글 (포트: 동적 할당)
- **Chat Service**: 실시간 채팅 (포트: 동적 할당)
- **Review Service**: 리뷰 관리 (포트: 동적 할당)
- **File Service**: 파일 업로드 (포트: 동적 할당)
- **WebSocket Service**: 실시간 통신 (포트: 동적 할당)

---

## 1. User Service API

### 1.1 인증 관련 API (`/auth`)

#### 1.1.1 회원가입

- **URL**: `POST /api/v1/user-service/auth/signup`
- **설명**: 새로운 사용자 계정을 생성합니다.
- **요청 본문**:
  ```json
  {
    "loginId": "string",
    "password": "string",
    "name": "string",
    "email": "string",
    "phoneNumber": "string",
    "address": "string",
    "oauthProvider": "string",
    "oauthId": "string",
    "isTermsAgreed": "boolean",
    "isPrivacyAgreed": "boolean",
    "nickname": "string",
    "profileImageUrl": "string",
    "role": "string"
  }
  ```
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "accessToken": "string",
      "refreshToken": "string",
      "user": {
        "id": "number",
        "nickname": "string",
        "email": "string",
        "profileImageUrl": "string",
        "createdAt": "2024-01-01T12:00:00"
      }
    },
    "errorCode": null,
    "message": null,
    "timestamp": "2024-01-01T12:00:00"
  }
  ```
- **쿠키**: HttpOnly 쿠키로 토큰 설정

#### 1.1.2 로그인

- **URL**: `POST /api/v1/user-service/auth/login`
- **설명**: 사용자 인증을 수행합니다.
- **요청 본문**:
  ```json
  {
    "loginId": "string",
    "password": "string"
  }
  ```
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "accessToken": "string",
      "refreshToken": "string",
      "user": {
        "id": "number",
        "nickname": "string",
        "email": "string",
        "profileImageUrl": "string",
        "createdAt": "2024-01-01T12:00:00"
      }
    },
    "errorCode": null,
    "message": null,
    "timestamp": "2024-01-01T12:00:00"
  }
  ```
- **쿠키**: HttpOnly 쿠키로 토큰 설정

#### 1.1.3 로그아웃

- **URL**: `POST /api/v1/user-service/auth/logout`
- **설명**: 사용자 로그아웃을 수행합니다.
- **헤더**: `X-User-Id`
- **응답**:
  ```json
  {
    "success": true,
    "data": null,
    "errorCode": null,
    "message": "로그아웃이 완료되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```
- **쿠키**: 토큰 쿠키 삭제

#### 1.1.4 토큰 재발급

- **URL**: `POST /api/v1/user-service/auth/refresh`
- **설명**: RefreshToken을 사용하여 새로운 AccessToken을 발급받습니다.
- **쿠키**: `refreshToken`
- **응답**:
  ```json
  {
    "success": true,
    "data": null,
    "errorCode": null,
    "message": "토큰이 재발급되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```
- **쿠키**: 새로운 AccessToken 쿠키

#### 1.1.5 계정 확인

- **URL**: `POST /api/v1/user-service/auth/verify-account`
- **설명**: 아이디 찾기/비밀번호 재설정을 위한 계정 확인
- **요청 본문**:
  ```json
  {
    "email": "string",
    "phoneNumber": "string"
  }
  ```
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "loginId": "string",
      "email": "string",
      "phoneNumber": "string"
    },
    "errorCode": null,
    "message": "계정이 확인되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 1.1.6 비밀번호 재설정

- **URL**: `PUT /api/v1/user-service/auth/reset-password`
- **설명**: 비밀번호를 재설정합니다.
- **요청 본문**:
  ```json
  {
    "email": "string",
    "newPassword": "string"
  }
  ```
- **응답**:
  ```json
  {
    "success": true,
    "data": "비밀번호가 성공적으로 변경되었습니다",
    "errorCode": null,
    "message": null,
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 1.1.7 토큰 검증

- **URL**: `POST /api/v1/user-service/auth/validate`
- **설명**: JWT 토큰을 검증합니다 (WebSocket 인증용)
- **요청 본문**:
  ```json
  {
    "token": "string"
  }
  ```
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "userId": "number",
      "valid": "boolean"
    },
    "errorCode": null,
    "message": "토큰이 유효합니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 1.1.8 쿠키 기반 토큰 검증

- **URL**: `POST /api/v1/user-service/auth/validate-cookie`
- **설명**: 쿠키의 AccessToken을 검증합니다 (WebSocket 인증용)
- **쿠키**: `accessToken`
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "userId": "number",
      "valid": "boolean"
    },
    "errorCode": null,
    "message": "토큰이 유효합니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

### 1.2 사용자 관리 API (`/users`)

#### 1.2.1 마이페이지 대시보드

- **URL**: `GET /api/v1/user-service/users/me/dashboard`
- **설명**: 마이페이지에 필요한 통합 정보를 조회합니다.
- **헤더**: `X-User-Id`
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "profileInfo": {
        "id": "number",
        "name": "string",
        "nickname": "string",
        "email": "string",
        "phoneNumber": "string",
        "profileImageUrl": "string"
      },
      "childList": [
        {
          "id": "number",
          "userId": "number",
          "name": "string",
          "birthDate": "string",
          "gender": "string",
          "createdAt": "string",
          "updatedAt": "string"
        }
      ],
      "transactionSummary": {
        "totalSalesCount": "number",
        "purchaseCount": "number",
        "reviewCount": "number"
      }
    },
    "errorCode": null,
    "message": "마이페이지 정보를 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 1.2.2 사용자 기본 정보 조회

- **URL**: `GET /api/v1/user-service/users/{userId}/basic`
- **설명**: 헤더용 기본 정보(닉네임, 이미지)를 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "id": "number",
      "nickname": "string",
      "profileImageUrl": "string"
    },
    "errorCode": null,
    "message": "사용자 기본 정보를 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 1.2.3 사용자 존재 여부 확인

- **URL**: `GET /api/v1/user-service/users/{userId}/exists`
- **설명**: 사용자 존재 여부를 확인합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": "boolean",
    "errorCode": null,
    "message": null,
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 1.2.4 사용자 상세 정보 조회

- **URL**: `GET /api/v1/user-service/users/{userId}`
- **설명**: 공개 프로필 정보를 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "id": "number",
      "name": "string",
      "nickname": "string",
      "profileImageUrl": "string",
      "createdAt": "string"
    },
    "errorCode": null,
    "message": "사용자 상세 정보를 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 1.2.5 프로필 수정용 정보 조회

- **URL**: `GET /api/v1/user-service/users/me/profile`
- **설명**: 프로필 수정을 위한 정보를 조회합니다.
- **헤더**: `X-User-Id`
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "id": "number",
      "name": "string",
      "nickname": "string",
      "email": "string",
      "phoneNumber": "string",
      "address": "string",
      "profileImageUrl": "string"
    },
    "errorCode": null,
    "message": "프로필 수정 정보를 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 1.2.6 프로필 수정

- **URL**: `PUT /api/v1/user-service/users/profile`
- **설명**: 사용자 프로필을 수정합니다.
- **헤더**: `X-User-Id`
- **요청 본문**:
  ```json
  {
    "nickname": "string",
    "phoneNumber": "string",
    "profileImage": "string"
  }
  ```
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "id": "number",
      "nickname": "string",
      "phoneNumber": "string",
      "profileImageUrl": "string",
      "updatedAt": "string"
    },
    "errorCode": null,
    "message": "프로필이 성공적으로 수정되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 1.2.7 비밀번호 변경

- **URL**: `PUT /api/v1/user-service/users/password`
- **설명**: 비밀번호를 변경합니다.
- **헤더**: `X-User-Id`
- **요청 본문**:
  ```json
  {
    "currentPassword": "string",
    "newPassword": "string",
    "confirmPassword": "string"
  }
  ```
- **응답**:
  ```json
  {
    "success": true,
    "data": null,
    "errorCode": null,
    "message": "비밀번호가 성공적으로 변경되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 1.2.8 회원탈퇴

- **URL**: `DELETE /api/v1/user-service/users/account`
- **설명**: 사용자 계정을 삭제합니다.
- **헤더**: `X-User-Id`
- **요청 본문**:
  ```json
  {
    "password": "string"
  }
  ```
- **응답**:
  ```json
  {
    "success": true,
    "data": null,
    "errorCode": null,
    "message": "회원탈퇴가 완료되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 1.2.9 중복 확인

- **URL**: `GET /api/v1/user-service/users/check`
- **파라미터**: `type` (email, nickname, phone), `value`
- **설명**: 이메일, 닉네임, 전화번호 중복을 확인합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "type": "string",
      "value": "string",
      "isDuplicate": "boolean"
    },
    "errorCode": null,
    "message": "중복 확인이 완료되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

### 1.3 자녀 관리 API (`/users/children`)

#### 1.3.1 자녀 정보 등록

- **URL**: `POST /api/v1/user-service/users/children`
- **설명**: 새로운 자녀 정보를 등록합니다.
- **헤더**: `X-User-Id`
- **요청 본문**:
  ```json
  {
    "name": "string",
    "birthDate": "string",
    "gender": "string"
  }
  ```
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "id": "number",
      "userId": "number",
      "name": "string",
      "birthDate": "string",
      "gender": "string",
      "createdAt": "string",
      "updatedAt": "string"
    },
    "errorCode": null,
    "message": "자녀 정보가 성공적으로 등록되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 1.3.2 자녀 목록 조회

- **URL**: `GET /api/v1/user-service/users/children`
- **설명**: 사용자의 자녀 목록을 조회합니다.
- **헤더**: `X-User-Id`
- **응답**:
  ```json
  {
    "success": true,
    "data": [
      {
        "id": "number",
        "userId": "number",
        "name": "string",
        "birthDate": "string",
        "gender": "string",
        "createdAt": "string",
        "updatedAt": "string"
      }
    ],
    "errorCode": null,
    "message": "자녀 목록을 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 1.3.3 자녀 정보 수정

- **URL**: `PUT /api/v1/user-service/users/children/{childId}`
- **설명**: 자녀 정보를 수정합니다.
- **헤더**: `X-User-Id`
- **요청 본문**:
  ```json
  {
    "name": "string",
    "birthDate": "string",
    "gender": "string"
  }
  ```
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "id": "number",
      "userId": "number",
      "name": "string",
      "birthDate": "string",
      "gender": "string",
      "updatedAt": "string"
    },
    "errorCode": null,
    "message": "자녀 정보가 성공적으로 수정되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 1.3.4 자녀 정보 삭제

- **URL**: `DELETE /api/v1/user-service/users/children/{childId}`
- **설명**: 자녀 정보를 삭제합니다.
- **헤더**: `X-User-Id`
- **응답**:
  ```json
  {
    "success": true,
    "data": null,
    "errorCode": null,
    "message": "자녀 정보가 성공적으로 삭제되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

---

## 2. Product Service API

### 2.1 상품 관리 API (`/products`)

#### 2.1.1 홈 상품 섹션 조회

- **URL**: `GET /api/v1/product-service/products/sections`
- **설명**: 홈 화면에 필요한 상품 섹션 정보를 조회합니다.
- **인증**: `@AuthenticationPrincipal` 사용자 ID 필요
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "recommendedProducts": [
        {
          "id": "number",
          "name": "string",
          "price": "number",
          "imageFileIds": ["number"],
          "sellerName": "string"
        }
      ],
      "recentProducts": [
        {
          "id": "number",
          "name": "string",
          "price": "number",
          "imageFileIds": ["number"],
          "sellerName": "string"
        }
      ],
      "popularCategories": [
        {
          "id": "number",
          "name": "string",
          "productCount": "number"
        }
      ]
    },
    "errorCode": null,
    "message": "홈 상품 섹션을 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 2.1.2 상품 요약 정보 조회

- **URL**: `GET /api/v1/product-service/products/summary`
- **파라미터**: `productIds` (리스트), `userId` (선택적)
- **설명**: 여러 상품의 요약 정보를 조회합니다.
- **인증**: `@AuthenticationPrincipal` 사용자 ID (선택적)
- **응답**:
  ```json
  {
    "success": true,
    "data": [
      {
        "id": "number",
        "name": "string",
        "price": "number",
        "imageFileIds": ["number"],
        "sellerName": "string",
        "tradeStatus": "string",
        "isWishlisted": "boolean"
      }
    ],
    "errorCode": null,
    "message": "상품 요약 정보를 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 2.1.3 상품 상세 조회

- **URL**: `GET /api/v1/product-service/products/{productId}`
- **설명**: 특정 상품의 상세 정보를 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "id": "number",
      "categoryId": "number",
      "name": "string",
      "content": "string",
      "price": "number",
      "productStatus": "string",
      "tradeStatus": "string",
      "recommendedAge": "string",
      "viewCount": "number",
      "imageFileIds": ["number"],
      "areaIds": ["number"],
      "hashtags": ["string"],
      "sellerId": "number",
      "sellerName": "string",
      "sellerProfileImage": "string",
      "createdAt": "string",
      "updatedAt": "string"
    },
    "errorCode": null,
    "message": "상품 정보를 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 2.1.4 상품 등록

- **URL**: `POST /api/v1/product-service/products`
- **설명**: 새로운 상품을 등록합니다.
- **인증**: `@AuthenticationPrincipal` 사용자 ID 필요
- **요청 본문**:
  ```json
  {
    "categoryId": "number",
    "name": "string",
    "content": "string",
    "price": "number",
    "productStatus": "string",
    "tradeStatus": "string",
    "recommendedAge": "string",
    "imageFileIds": ["number"],
    "areaIds": ["number"],
    "hashtags": ["string"]
  }
  ```
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "productId": "number"
    },
    "errorCode": null,
    "message": "상품이 성공적으로 등록되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

### 2.2 카테고리 관리 API (`/categories`)

#### 2.2.1 카테고리 목록 조회

- **URL**: `GET /api/v1/product-service/categories`
- **설명**: 모든 카테고리를 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": [
      {
        "id": "number",
        "name": "string",
        "description": "string",
        "productCount": "number"
      }
    ],
    "errorCode": null,
    "message": "카테고리 목록을 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

### 2.3 지역 관리 API (`/areas`)

#### 2.3.1 지역 목록 조회

- **URL**: `GET /api/v1/product-service/areas`
- **설명**: 모든 지역을 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": [
      {
        "id": "number",
        "name": "string",
        "parentId": "number"
      }
    ],
    "errorCode": null,
    "message": "지역 목록을 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

### 2.4 거래 관리 API (`/trades`)

#### 2.4.1 거래 상태 변경

- **URL**: `PUT /api/v1/product-service/trades/{productId}/status`
- **설명**: 상품의 거래 상태를 변경합니다.
- **인증**: 사용자 ID 필요
- **요청 본문**:
  ```json
  {
    "status": "string"
  }
  ```
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "productId": "number",
      "status": "string",
      "updatedAt": "string"
    },
    "errorCode": null,
    "message": "거래 상태가 성공적으로 변경되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

---

## 3. Post Service API

### 3.1 게시글 관리 API (`/posts`)

#### 3.1.1 게시글 등록

- **URL**: `POST /api/v1/post-service/posts`
- **설명**: 새로운 게시글을 등록합니다.
- **Content-Type**: `multipart/form-data`
- **파라미터**:
  - `userId`: 사용자 ID
  - `title`: 제목
  - `contentHtml`: 내용 (HTML)
  - `categoryName`: 카테고리명
  - `images`: 이미지 파일들 (선택)
- **응답**:
  ```json
  {
    "success": true,
    "data": "number",
    "errorCode": null,
    "message": null,
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 3.1.2 게시글 상세 조회

- **URL**: `GET /api/v1/post-service/posts/{id}`
- **설명**: 게시글과 댓글, 좋아요 정보를 함께 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "post": {
        "id": "number",
        "userId": "number",
        "title": "string",
        "contentHtml": "string",
        "hasImage": "boolean",
        "categoryName": "string",
        "imageUrls": ["string"],
        "viewCount": "number",
        "user": {
          "id": "number",
          "name": "string",
          "nickname": "string",
          "profileImageUrl": "string"
        },
        "createdAt": "string",
        "updatedAt": "string"
      },
      "comments": [
        {
          "id": "number",
          "content": "string",
          "userId": "number",
          "userName": "string",
          "userNickname": "string",
          "createdAt": "string"
        }
      ],
      "like": {
        "postId": "number",
        "likeCount": "number",
        "isLiked": "boolean"
      }
    },
    "errorCode": null,
    "message": null,
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 3.1.3 게시글 목록 조회

- **URL**: `GET /api/v1/post-service/posts`
- **파라미터**: `category` (선택), `page`, `size`
- **설명**: 게시글 목록을 페이징하여 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "content": [
        {
          "id": "number",
          "title": "string",
          "contentHtml": "string",
          "categoryName": "string",
          "viewCount": "number",
          "user": {
            "id": "number",
            "name": "string",
            "nickname": "string",
            "profileImageUrl": "string"
          },
          "createdAt": "string"
        }
      ],
      "totalElements": "number",
      "totalPages": "number",
      "size": "number",
      "number": "number"
    },
    "errorCode": null,
    "message": null,
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 3.1.4 게시글 수정

- **URL**: `PUT /api/v1/post-service/posts/{id}`
- **설명**: 게시글을 수정합니다.
- **요청 본문**:
  ```json
  {
    "title": "string",
    "contentHtml": "string",
    "categoryName": "string"
  }
  ```
- **응답**:
  ```json
  {
    "success": true,
    "data": "number",
    "errorCode": null,
    "message": null,
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 3.1.5 게시글 삭제

- **URL**: `DELETE /api/v1/post-service/posts/{id}`
- **설명**: 게시글을 삭제합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": "number",
    "errorCode": null,
    "message": null,
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

### 3.2 댓글 관리 API (`/posts/{postId}/comments`)

#### 3.2.1 댓글 등록

- **URL**: `POST /api/v1/post-service/posts/{postId}/comments`
- **설명**: 새로운 댓글을 등록합니다.
- **요청 본문**:
  ```json
  {
    "userId": "number",
    "content": "string"
  }
  ```
- **응답**:
  ```json
  {
    "id": "number",
    "postId": "number",
    "userId": "number",
    "content": "string",
    "userName": "string",
    "userNickname": "string",
    "createdAt": "string"
  }
  ```

#### 3.2.2 댓글 삭제

- **URL**: `DELETE /api/v1/post-service/posts/{postId}/comments/{commentId}`
- **설명**: 댓글을 삭제합니다.
- **요청 본문**:
  ```json
  {
    "userId": "number"
  }
  ```
- **응답**: 204 No Content

### 3.3 좋아요 관리 API (`/posts/{postId}/likes`)

#### 3.3.1 좋아요 추가

- **URL**: `POST /api/v1/post-service/posts/{postId}/likes`
- **설명**: 게시글에 좋아요를 추가합니다.
- **요청 본문**:
  ```json
  {
    "userId": "number"
  }
  ```
- **응답**:
  ```json
  {
    "postId": "number",
    "userId": "number",
    "liked": "boolean",
    "likeCount": "number"
  }
  ```

#### 3.3.2 좋아요 취소

- **URL**: `DELETE /api/v1/post-service/posts/{postId}/likes`
- **설명**: 게시글의 좋아요를 취소합니다.
- **요청 본문**:
  ```json
  {
    "userId": "number"
  }
  ```
- **응답**:
  ```json
  {
    "postId": "number",
    "userId": "number",
    "liked": "boolean",
    "likeCount": "number"
  }
  ```

---

## 4. Chat Service API

### 4.1 채팅방 관리 API (`/rooms`)

#### 4.1.1 채팅방 생성

- **URL**: `POST /api/v1/chat-service/rooms`
- **설명**: 새로운 채팅방을 생성합니다 (이미 있으면 기존 방 반환).
- **요청 본문**:
  ```json
  {
    "productId": "number",
    "buyerId": "number",
    "sellerId": "number"
  }
  ```
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "roomId": "number",
      "productId": "number",
      "buyerId": "number",
      "sellerId": "number",
      "createdAt": "string"
    },
    "errorCode": null,
    "message": "채팅방이 생성되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 4.1.2 내 채팅방 목록

- **URL**: `GET /api/v1/chat-service/rooms/me/{userId}`
- **설명**: 사용자가 참여한 채팅방을 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": [
      {
        "roomId": "number",
        "lastMessage": "string",
        "lastSentAt": "string",
        "unreadCount": "number"
      }
    ],
    "errorCode": null,
    "message": "채팅방 목록을 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 4.1.3 채팅방 참여자 목록

- **URL**: `GET /api/v1/chat-service/rooms/{roomId}/participants`
- **설명**: 채팅방의 참여자 목록을 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": [
      {
        "userId": "number",
        "name": "string",
        "nickname": "string",
        "profileImageUrl": "string",
        "role": "string"
      }
    ],
    "errorCode": null,
    "message": "채팅방 참여자 목록을 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

### 4.2 메시지 관리 API (`/rooms/{roomId}/messages`)

#### 4.2.1 메시지 전송

- **URL**: `POST /api/v1/chat-service/rooms/{roomId}/messages`
- **설명**: 채팅 메시지를 전송합니다.
- **요청 본문**:
  ```json
  {
    "senderId": "number",
    "content": "string",
    "messageType": "string"
  }
  ```
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "id": "number",
      "roomId": "number",
      "senderId": "number",
      "content": "string",
      "messageType": "string",
      "createdAt": "string"
    },
    "errorCode": null,
    "message": "메시지가 성공적으로 전송되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 4.2.2 메시지 목록 조회

- **URL**: `GET /api/v1/chat-service/rooms/{roomId}/messages`
- **파라미터**: `page` (기본값: 0), `size` (기본값: 20)
- **설명**: 채팅방의 메시지 목록을 페이징하여 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "content": [
        {
          "id": "number",
          "roomId": "number",
          "senderId": "number",
          "senderName": "string",
          "content": "string",
          "messageType": "string",
          "isRead": "boolean",
          "createdAt": "string"
        }
      ],
      "page": "number",
      "size": "number",
      "total": "number"
    },
    "errorCode": null,
    "message": "메시지 목록을 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 4.2.3 읽음 처리

- **URL**: `POST /api/v1/chat-service/rooms/{roomId}/messages/read`
- **설명**: 메시지를 읽음 처리합니다.
- **요청 본문**:
  ```json
  {
    "userId": "number"
  }
  ```
- **응답**:
  ```json
  {
    "success": true,
    "data": null,
    "errorCode": null,
    "message": "읽음 처리가 완료되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 4.2.4 방별 읽지 않은 메시지 수 조회

- **URL**: `GET /api/v1/chat-service/rooms/{roomId}/messages/unread`
- **파라미터**: `userId`
- **설명**: 특정 방의 읽지 않은 메시지 수를 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "roomId": "number",
      "unreadCount": "number"
    },
    "errorCode": null,
    "message": "읽지 않은 메시지 수를 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

### 4.3 읽지 않은 메시지 API (`/me/{userId}/unread`)

#### 4.3.1 전체 읽지 않은 메시지 수 조회

- **URL**: `GET /api/v1/chat-service/me/{userId}/unread`
- **설명**: 사용자의 모든 방의 읽지 않은 메시지 수를 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "totalUnreadCount": "number",
      "roomUnreadCounts": [
        {
          "roomId": "number",
          "unreadCount": "number"
        }
      ]
    },
    "errorCode": null,
    "message": "읽지 않은 메시지 수를 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

### 4.4 WebSocket 연결

- **URL**: `ws://localhost:8000/ws-stomp`
- **설명**: 실시간 채팅을 위한 WebSocket 연결

---

## 5. Review Service API

### 5.1 리뷰 관리 API (`/reviews`)

#### 5.1.1 리뷰 등록

- **URL**: `POST /api/v1/review-service/reviews`
- **설명**: 새로운 리뷰를 등록합니다.
- **요청 본문**:
  ```json
  {
    "rating": "number",
    "content": "string",
    "kind": "boolean",
    "promise": "boolean",
    "satisfaction": "boolean"
  }
  ```
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "id": "number",
      "userId": "number",
      "productId": "number",
      "rating": "number",
      "content": "string",
      "kind": "boolean",
      "promise": "boolean",
      "satisfaction": "boolean",
      "userName": "string",
      "productName": "string",
      "createdAt": "string",
      "updatedAt": "string"
    },
    "errorCode": null,
    "message": "리뷰가 성공적으로 등록되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 5.1.2 리뷰 상세 조회

- **URL**: `GET /api/v1/review-service/reviews/{reviewId}`
- **설명**: 특정 리뷰의 상세 정보를 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "id": "number",
      "userId": "number",
      "productId": "number",
      "rating": "number",
      "content": "string",
      "kind": "boolean",
      "promise": "boolean",
      "satisfaction": "boolean",
      "userName": "string",
      "productName": "string",
      "createdAt": "string",
      "updatedAt": "string"
    },
    "errorCode": null,
    "message": "리뷰 상세 정보를 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 5.1.3 리뷰 수정

- **URL**: `PUT /api/v1/review-service/reviews/{reviewId}`
- **설명**: 리뷰를 수정합니다.
- **요청 본문**:
  ```json
  {
    "rating": "number",
    "content": "string",
    "kind": "boolean",
    "promise": "boolean",
    "satisfaction": "boolean"
  }
  ```
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "id": "number",
      "rating": "number",
      "content": "string",
      "kind": "boolean",
      "promise": "boolean",
      "satisfaction": "boolean",
      "updatedAt": "string"
    },
    "errorCode": null,
    "message": "리뷰가 성공적으로 수정되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 5.1.4 리뷰 삭제

- **URL**: `DELETE /api/v1/review-service/reviews/{reviewId}`
- **설명**: 리뷰를 삭제합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": "string",
    "errorCode": null,
    "message": "리뷰가 성공적으로 삭제되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 5.1.5 전체 리뷰 조회

- **URL**: `GET /api/v1/review-service/reviews`
- **설명**: 모든 리뷰를 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": [
      {
        "id": "number",
        "userId": "number",
        "productId": "number",
        "rating": "number",
        "content": "string",
        "kind": "boolean",
        "promise": "boolean",
        "satisfaction": "boolean",
        "userName": "string",
        "productName": "string",
        "createdAt": "string"
      }
    ],
    "errorCode": null,
    "message": "전체 리뷰를 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

### 5.2 사용자별 리뷰 API

#### 5.2.1 사용자 리뷰 개수 조회

- **URL**: `GET /api/v1/review-service/reviews/users/{userId}/count`
- **설명**: 특정 사용자의 리뷰 개수를 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "reviewCount": "number"
    },
    "errorCode": null,
    "message": null,
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 5.2.2 사용자 리뷰 목록 조회

- **URL**: `GET /api/v1/review-service/reviews/users/{userId}`
- **설명**: 특정 사용자의 모든 리뷰를 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": [
      {
        "id": "number",
        "productId": "number",
        "rating": "number",
        "content": "string",
        "kind": "boolean",
        "promise": "boolean",
        "satisfaction": "boolean",
        "productName": "string",
        "createdAt": "string"
      }
    ],
    "errorCode": null,
    "message": "사용자 리뷰 목록을 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

### 5.3 리뷰 통계 API

#### 5.3.1 리뷰 통계 조회

- **URL**: `GET /api/v1/review-service/reviews/status`
- **설명**: 리뷰 통계 정보를 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "totalReviews": "number",
      "averageRating": "number",
      "positiveReviews": "number",
      "negativeReviews": "number",
      "recentReviews": "number"
    },
    "errorCode": null,
    "message": "리뷰 통계를 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 5.3.2 명예의 전당 (상위 3명)

- **URL**: `GET /api/v1/review-service/reviews/top3`
- **설명**: 리뷰가 많은 상위 3명 사용자를 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": [
      {
        "rank": "number",
        "userId": "number",
        "userName": "string",
        "reviewCount": "number",
        "averageRating": "number"
      }
    ],
    "errorCode": null,
    "message": "명예의 전당을 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

### 5.4 리뷰 요약 API

#### 5.4.1 감정별 요약 조회

- **URL**: `GET /api/v1/review-service/reviews/summary`
- **파라미터**: `sentiment` (긍정적/부정적)
- **설명**: 특정 감정의 리뷰 요약을 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": "string",
    "errorCode": null,
    "message": "리뷰 요약을 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 5.4.2 모든 요약 조회

- **URL**: `GET /api/v1/review-service/reviews/summary/all`
- **설명**: 모든 감정별 요약을 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": [
      {
        "sentiment": "string",
        "summary": "string",
        "reviewCount": "number"
      }
    ],
    "errorCode": null,
    "message": "모든 요약을 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 5.4.3 요약 재생성

- **URL**: `POST /api/v1/review-service/reviews/summary/regenerate`
- **설명**: 모든 감정별 요약을 재생성합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": "string",
    "errorCode": null,
    "message": "모든 감정별 요약글이 성공적으로 재생성되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 5.4.4 특정 감정 요약 재생성

- **URL**: `POST /api/v1/review-service/reviews/summary/regenerate/{sentiment}`
- **설명**: 특정 감정의 요약을 재생성합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": "string",
    "errorCode": null,
    "message": "요약글이 재생성되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 5.4.5 요약 상태 조회

- **URL**: `GET /api/v1/review-service/reviews/summary/status`
- **설명**: 요약 상태 정보를 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "positiveReviews": "number",
      "negativeReviews": "number",
      "positiveSummary": "string",
      "negativeSummary": "string"
    },
    "errorCode": null,
    "message": "요약 상태를 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

---

## 6. File Service API

### 6.1 파일 관리 API (`/files`)

#### 6.1.1 파일 서버 URL 조회

- **URL**: `GET /api/v1/file-service/files/server-url`
- **설명**: 파일 서버의 기본 URL을 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": {
      "fileServiceUrl": "string"
    },
    "errorCode": null,
    "message": "파일 서버 URL을 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 6.1.2 이미지 정보 조회

- **URL**: `GET /api/v1/file-service/files`
- **파라미터**: `ids` (리스트)
- **설명**: 이미지 ID 리스트로 이미지 정보를 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": [
      {
        "id": "number",
        "fileName": "string",
        "fileUrl": "string",
        "fileSize": "number",
        "uploadedAt": "string"
      }
    ],
    "errorCode": null,
    "message": "이미지 정보를 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 6.1.3 파일 업로드

- **URL**: `POST /api/v1/file-service/files`
- **설명**: 이미지 파일들을 업로드합니다.
- **파라미터**: `imageFiles` (MultipartFile 리스트)
- **응답**:
  ```json
  {
    "success": true,
    "data": [
      {
        "id": "number",
        "fileName": "string",
        "fileUrl": "string",
        "fileSize": "number",
        "uploadedAt": "string"
      }
    ],
    "errorCode": null,
    "message": "파일이 성공적으로 업로드되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 6.1.4 FTP 경로 파일 목록

- **URL**: `GET /api/v1/file-service/files/path`
- **설명**: FTP 경로에 있는 이미지 파일 목록을 조회합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": ["string"],
    "errorCode": null,
    "message": "FTP 경로 파일 목록을 성공적으로 조회했습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

#### 6.1.5 FTP 경로 모든 파일 삭제

- **URL**: `DELETE /api/v1/file-service/files/path`
- **설명**: FTP 경로의 모든 파일을 삭제합니다.
- **응답**:
  ```json
  {
    "success": true,
    "data": ["string"],
    "errorCode": null,
    "message": "FTP 경로의 모든 파일이 성공적으로 삭제되었습니다.",
    "timestamp": "2024-01-01T12:00:00"
  }
  ```

---

## 7. WebSocket Service

### 7.1 WebSocket 연결

- **URL**: `ws://localhost:8000/ws-stomp`
- **설명**: 실시간 채팅을 위한 WebSocket 연결

### 7.2 SockJS 연결

- **URL**: `http://localhost:8000/ws-stomp`
- **설명**: SockJS를 통한 WebSocket 연결

### 7.3 WebSocket 메시지 API

#### 7.3.1 메시지 전송

- **Destination**: `/app/chat.sendMessage`
- **설명**: 채팅 메시지를 전송합니다.
- **요청 본문**:
  ```json
  {
    "roomId": "number",
    "senderId": "string",
    "content": "string",
    "messageType": "string"
  }
  ```

#### 7.3.2 사용자 추가

- **Destination**: `/app/chat.addUser`
- **설명**: 채팅방에 사용자를 추가합니다.
- **요청 본문**:
  ```json
  {
    "roomId": "number",
    "senderId": "string"
  }
  ```

#### 7.3.3 읽음 처리

- **Destination**: `/app/chat.markAsRead`
- **설명**: 메시지를 읽음 처리합니다.
- **요청 본문**:
  ```json
  {
    "userId": "string"
  }
  ```

### 7.4 WebSocket 구독

#### 7.4.1 채팅방 메시지 구독

- **Destination**: `/topic/room.{roomId}`
- **설명**: 특정 채팅방의 메시지를 구독합니다.

#### 7.4.2 개인 알림 구독

- **Destination**: `/queue/notice`
- **설명**: 개인 알림을 구독합니다.

#### 7.4.3 에러 알림 구독

- **Destination**: `/queue/error`
- **설명**: 에러 알림을 구독합니다.

#### 7.4.4 읽음 확인 구독

- **Destination**: `/queue/read-confirmation`
- **설명**: 읽음 처리 확인을 구독합니다.

---

## 8. 공통 응답 형식

### 8.1 성공 응답

```json
{
  "success": true,
  "data": {
    // 실제 데이터
  },
  "errorCode": null,
  "message": null,
  "timestamp": "2024-01-01T12:00:00"
}
```

### 8.2 실패 응답

```json
{
  "success": false,
  "data": null,
  "errorCode": "ERROR_CODE",
  "message": "에러 메시지",
  "timestamp": "2024-01-01T12:00:00"
}
```

### 8.3 페이징 응답

```json
{
  "success": true,
  "data": {
    "content": [
      // 데이터 리스트
    ],
    "pageable": {
      "pageNumber": "number",
      "pageSize": "number",
      "sort": {
        "sorted": "boolean",
        "unsorted": "boolean"
      }
    },
    "totalElements": "number",
    "totalPages": "number",
    "last": "boolean",
    "first": "boolean",
    "numberOfElements": "number",
    "size": "number",
    "number": "number",
    "sort": {
      "sorted": "boolean",
      "unsorted": "boolean"
    }
  },
  "errorCode": null,
  "message": null,
  "timestamp": "2024-01-01T12:00:00"
}
```

---

## 9. 인증 및 보안

### 9.1 JWT 토큰

- **AccessToken**: 1시간 유효 (향후 30분으로 변경 예정)
- **RefreshToken**: 7일 유효
- **쿠키 설정**: HttpOnly, Secure, SameSite=Lax

### 9.2 헤더 인증

- **X-User-Id**: 사용자 ID (Gateway에서 설정)
- **Authorization**: Bearer 토큰 (필요시)

### 9.3 CORS 설정

- **허용 Origin**: `http://localhost:3000`
- **허용 메서드**: GET, POST, PUT, PATCH, DELETE, OPTIONS
- **허용 헤더**: 모든 헤더
- **Credentials**: true

---

## 10. 에러 코드

### 10.1 공통 에러 코드

- `USER_NOT_FOUND`: 사용자를 찾을 수 없음
- `UNAUTHORIZED`: 인증 실패
- `FORBIDDEN`: 권한 없음
- `VALIDATION_ERROR`: 유효성 검사 실패
- `INTERNAL_SERVER_ERROR`: 서버 내부 오류

### 10.2 서비스별 에러 코드

- `PRODUCT_NOT_FOUND`: 상품을 찾을 수 없음
- `POST_NOT_FOUND`: 게시글을 찾을 수 없음
- `REVIEW_NOT_FOUND`: 리뷰를 찾을 수 없음
- `CHAT_ROOM_NOT_FOUND`: 채팅방을 찾을 수 없음
- `FILE_UPLOAD_ERROR`: 파일 업로드 실패

---

## 11. 개발 환경 설정

### 11.1 서비스 실행 순서

1. Discovery Service (Eureka Server)
2. Gateway Service
3. 각 마이크로서비스 (User, Product, Post, Chat, Review, File, WebSocket)

### 11.2 Swagger UI 접속

- **Gateway**: `http://localhost:8000/swagger-ui.html`
- **개별 서비스**: 각 서비스의 포트로 접속

### 11.3 데이터베이스

- 각 서비스는 독립적인 데이터베이스를 사용
- JPA Hibernate DDL-Auto: update 설정

### 11.4 로깅

- 각 서비스별로 독립적인 로그 관리
- SQL 로그 출력 설정 (개발 환경)

---

## 12. 모니터링 및 운영

### 12.1 서비스 디스커버리

- **Eureka Dashboard**: `http://localhost:8761`
- **서비스 등록**: 자동 등록 (Eureka Client)
- **헬스 체크**: 자동 헬스 체크

### 12.2 API 문서화

- **Swagger**: 각 서비스별 자동 문서 생성
- **API 버전**: v1 사용
- **문서 접근**: Gateway를 통한 통합 문서

### 12.3 로드 밸런싱

- **Gateway**: Spring Cloud Gateway의 로드 밸런서 사용
- **서비스 인스턴스**: 동적 포트 할당으로 다중 인스턴스 지원

---

이 인터페이스 설계서는 Momnect 서비스의 모든 API 엔드포인트와 사용법을 포함하고 있습니다. 각 서비스는 독립적으로 개발 및 배포가 가능하며, API Gateway를 통해 통합 관리됩니다.

---
